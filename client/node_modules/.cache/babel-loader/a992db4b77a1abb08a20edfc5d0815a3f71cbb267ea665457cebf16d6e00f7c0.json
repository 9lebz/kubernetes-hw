{"ast":null,"code":"import _regeneratorRuntime from\"/home/gleb/real-time-client-server-course/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/home/gleb/real-time-client-server-course/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/home/gleb/real-time-client-server-course/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/gleb/real-time-client-server-course/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EventSourcing=function EventSourcing(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),value=_useState4[0],setValue=_useState4[1];useEffect(function(){subscribe();},[]);var subscribe=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var eventSource;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:eventSource=new EventSource(\"\".concat(import.meta.env.VITE_API_URL,\"/connect\"));eventSource.onmessage=function(event){console.log(event.data);var message=JSON.parse(event.data);setMessages(function(prev){return[message].concat(_toConsumableArray(prev));});};case 2:case\"end\":return _context.stop();}},_callee);}));return function subscribe(){return _ref.apply(this,arguments);};}();var sendMessage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post(\"\".concat(import.meta.env.VITE_API_URL,\"/new-messages\"),{message:value,id:Date.now()});case 2:case\"end\":return _context2.stop();}},_callee2);}));return function sendMessage(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"center\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form\",children:[/*#__PURE__*/_jsx(\"input\",{value:value,onChange:function onChange(e){return setValue(e.target.value);},type:\"text\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"messages\",children:messages.map(function(mess){return/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:mess.message},mess.id);})})]})});};export default EventSourcing;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","EventSourcing","_useState","_useState2","_slicedToArray","messages","setMessages","_useState3","_useState4","value","setValue","subscribe","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","eventSource","wrap","_callee$","_context","prev","next","EventSource","concat","import","meta","env","VITE_API_URL","onmessage","event","console","log","data","message","JSON","parse","_toConsumableArray","stop","apply","arguments","sendMessage","_ref2","_callee2","_callee2$","_context2","post","id","Date","now","className","children","onChange","e","target","type","onClick","map","mess"],"sources":["/home/gleb/real-time-client-server-course/client/src/EventSourcing.jsx"],"sourcesContent":["import React, {useEffect, useState} from 'react';\nimport axios from \"axios\";\n\nconst EventSourcing = () => {\n    const [messages, setMessages] = useState([]);\n    const [value, setValue] = useState('');\n\n\n    useEffect(() => {\n        subscribe()\n    }, [])\n\n    const subscribe = async () => {\n        const eventSource = new EventSource(`${import.meta.env.VITE_API_URL}/connect`)\n        eventSource.onmessage = function (event) {\n            console.log(event.data)\n            const message = JSON.parse(event.data);\n            setMessages(prev => [message, ...prev]);\n        }\n    }\n\n    const sendMessage = async () => {\n        await axios.post(`${import.meta.env.VITE_API_URL}/new-messages`, {\n            message: value,\n            id: Date.now()\n        })\n    }\n\n    return (\n        <div className=\"center\">\n            <div>\n                <div className=\"form\">\n                    <input value={value} onChange={e => setValue(e.target.value)} type=\"text\"/>\n                    <button onClick={sendMessage}>Отправить</button>\n                </div>\n                <div className=\"messages\">\n                    {messages.map(mess =>\n                        <div className=\"message\" key={mess.id}>\n                            {mess.message}\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default EventSourcing;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}